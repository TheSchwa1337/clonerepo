<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü Schwabot Real-Time Crypto Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 60px 1fr;
            grid-template-areas: 
                "sidebar header"
                "sidebar main";
            min-height: 100vh;
        }

        /* Header */
        .header {
            grid-area: header;
            background: rgba(30, 30, 50, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00ff88;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 20px rgba(0, 255, 136, 0.3);
        }

        .header h1 {
            color: #00ff88;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .connection-status {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected { background: #00ff88; }
        .status-disconnected { background: #ff4444; }
        .status-connecting { background: #ffaa00; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: rgba(20, 20, 35, 0.95);
            border-right: 2px solid #333;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .panel-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .panel-toggle:hover {
            background: rgba(0, 255, 136, 0.1);
        }

        .panel-toggle input[type="checkbox"] {
            accent-color: #00ff88;
        }

        .system-info {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .system-metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .metric-value {
            color: #00ff88;
            font-weight: bold;
        }

        /* Main Dashboard */
        .main-dashboard {
            grid-area: main;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .panels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        /* Panel Styles */
        .panel {
            background: rgba(30, 30, 50, 0.9);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .panel:hover {
            border-color: #00ff88;
            box-shadow: 0 5px 25px rgba(0, 255, 136, 0.2);
        }

        .panel.hidden {
            display: none;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .panel-title {
            color: #00ff88;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .panel-status {
            font-size: 0.8rem;
            color: #888;
        }

        /* Crypto-specific panels */
        .crypto-price-panel {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 200, 100, 0.08));
            border-color: #00ff88;
        }

        .crypto-volume-panel {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 140, 0, 0.08));
            border-color: #ffa500;
        }

        .entry-exit-signals {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.15), rgba(200, 0, 200, 0.08));
            border-color: #ff00ff;
        }

        .fault-bus-monitor {
            background: linear-gradient(135deg, rgba(255, 69, 0, 0.15), rgba(255, 0, 0, 0.08));
            border-color: #ff4500;
        }

        /* Chart containers */
        .chart-container {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .price-chart {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.1), rgba(0, 200, 100, 0.05));
        }

        .volume-chart {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 165, 0, 0.1), rgba(255, 140, 0, 0.05));
        }

        /* Signal indicators */
        .signal-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: signal-pulse 1s infinite;
        }

        .signal-entry { background: #00ff88; }
        .signal-exit { background: #ff4444; }
        .signal-hold { background: #ffaa00; }

        @keyframes signal-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Data grid for metrics */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .data-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .data-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        .data-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #00ff88;
        }

        .data-value.positive { color: #00ff88; }
        .data-value.negative { color: #ff4444; }
        .data-value.neutral { color: #ffaa00; }

        /* Responsive design */
        @media (max-width: 1200px) {
            .panels-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main";
            }
            
            .sidebar {
                display: none;
            }
            
            .panels-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <h1>üåü Schwabot Real-Time Crypto Dashboard</h1>
            <div class="connection-status">
                <span id="connection-text">Connecting...</span>
                <div id="connection-indicator" class="status-indicator status-connecting"></div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>üìä Dashboard Panels</h3>
            
            <div class="panel-toggle">
                <input type="checkbox" id="toggle-crypto-prices" checked>
                <label for="toggle-crypto-prices">Crypto Prices (BTC/ETH/XRP)</label>
            </div>
            
            <div class="panel-toggle">
                <input type="checkbox" id="toggle-crypto-volumes" checked>
                <label for="toggle-crypto-volumes">Volume Analysis</label>
            </div>
            
            <div class="panel-toggle">
                <input type="checkbox" id="toggle-entry-exit" checked>
                <label for="toggle-entry-exit">Entry/Exit Signals</label>
            </div>
            
            <div class="panel-toggle">
                <input type="checkbox" id="toggle-fault-bus" checked>
                <label for="toggle-fault-bus">Fault Bus Monitor</label>
            </div>

            <div class="system-info">
                <h4>üñ•Ô∏è System Status</h4>
                <div class="system-metric">
                    <span>Uptime:</span>
                    <span class="metric-value" id="uptime">--</span>
                </div>
                <div class="system-metric">
                    <span>CPU Usage:</span>
                    <span class="metric-value" id="cpu-usage">--</span>
                </div>
                <div class="system-metric">
                    <span>Memory Usage:</span>
                    <span class="metric-value" id="memory-usage">--</span>
                </div>
                <div class="system-metric">
                    <span>Active Connections:</span>
                    <span class="metric-value" id="active-connections">--</span>
                </div>
                <div class="system-metric">
                    <span>Last Update:</span>
                    <span class="metric-value" id="last-update">--</span>
                </div>
            </div>
        </aside>

        <!-- Main Dashboard -->
        <main class="main-dashboard">
            <div class="panels-grid">
                <!-- Real-Time Crypto Price Panel -->
                <div class="panel crypto-price-panel" id="panel-crypto-prices">
                    <div class="panel-header">
                        <h3 class="panel-title">üí∞ Real-Time Crypto Prices</h3>
                        <span class="panel-status" id="crypto-prices-status">Live</span>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="price-chart" class="price-chart"></canvas>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">BTC Price</div>
                            <div class="data-value" id="btc-price">$--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">ETH Price</div>
                            <div class="data-value" id="eth-price">$--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">XRP Price</div>
                            <div class="data-value" id="xrp-price">$--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">24h Change</div>
                            <div class="data-value" id="24h-change">--</div>
                        </div>
                    </div>
                </div>

                <!-- Volume Analysis Panel -->
                <div class="panel crypto-volume-panel" id="panel-crypto-volumes">
                    <div class="panel-header">
                        <h3 class="panel-title">üìà Volume Analysis</h3>
                        <span class="panel-status" id="crypto-volumes-status">Live</span>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="volume-chart" class="volume-chart"></canvas>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">BTC Volume</div>
                            <div class="data-value" id="btc-volume">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">ETH Volume</div>
                            <div class="data-value" id="eth-volume">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">XRP Volume</div>
                            <div class="data-value" id="xrp-volume">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Volume Trend</div>
                            <div class="data-value" id="volume-trend">--</div>
                        </div>
                    </div>
                </div>

                <!-- Entry/Exit Signals Panel -->
                <div class="panel entry-exit-signals" id="panel-entry-exit">
                    <div class="panel-header">
                        <h3 class="panel-title">üéØ Entry/Exit Signals</h3>
                        <span class="panel-status" id="entry-exit-status">Live</span>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">BTC Signal</div>
                            <div class="data-value" id="btc-signal">
                                <span class="signal-indicator signal-hold"></span>HOLD
                            </div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">ETH Signal</div>
                            <div class="data-value" id="eth-signal">
                                <span class="signal-indicator signal-hold"></span>HOLD
                            </div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">XRP Signal</div>
                            <div class="data-value" id="xrp-signal">
                                <span class="signal-indicator signal-hold"></span>HOLD
                            </div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Signal Confidence</div>
                            <div class="data-value" id="signal-confidence">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">DLT Acceleration</div>
                            <div class="data-value" id="dlt-acceleration">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Multi-Bit Confidence</div>
                            <div class="data-value" id="multi-bit-confidence">--</div>
                        </div>
                    </div>
                </div>

                <!-- Fault Bus Monitor Panel -->
                <div class="panel fault-bus-monitor" id="panel-fault-bus">
                    <div class="panel-header">
                        <h3 class="panel-title">üß† Fault Bus Monitor</h3>
                        <span class="panel-status" id="fault-bus-status">Live</span>
                    </div>
                    
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">Active Faults</div>
                            <div class="data-value" id="active-faults">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Best Strategy</div>
                            <div class="data-value" id="best-strategy">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Strategy Score</div>
                            <div class="data-value" id="strategy-score">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Corridor State</div>
                            <div class="data-value" id="corridor-state">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Profit Context</div>
                            <div class="data-value" id="profit-context">--</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Thermal State</div>
                            <div class="data-value" id="thermal-state">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chart.js for real-time charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        class EnhancedCryptoDashboard {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.reconnectDelay = 1000;
                this.updateInterval = 225000; // 3.75 minutes (225 seconds)
                this.cryptoData = {
                    btc: { price: 0, volume: 0, change24h: 0 },
                    eth: { price: 0, volume: 0, change24h: 0 },
                    xrp: { price: 0, volume: 0, change24h: 0 }
                };
                this.faultBusData = {};
                this.charts = {};
                
                this.init();
            }

            async init() {
                console.log('üåü Initializing Enhanced Schwabot Crypto Dashboard...');
                this.setupPanelToggles();
                this.setupCharts();
                this.startDataUpdates();
                this.connect();
            }

            setupCharts() {
                // Price chart
                const priceCtx = document.getElementById('price-chart').getContext('2d');
                this.charts.price = new Chart(priceCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'BTC',
                                data: [],
                                borderColor: '#00ff88',
                                backgroundColor: 'rgba(0, 255, 136, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'ETH',
                                data: [],
                                borderColor: '#ffa500',
                                backgroundColor: 'rgba(255, 165, 0, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'XRP',
                                data: [],
                                borderColor: '#ff00ff',
                                backgroundColor: 'rgba(255, 0, 255, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#e0e0e0' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#888' },
                                grid: { color: '#333' }
                            },
                            y: {
                                ticks: { color: '#888' },
                                grid: { color: '#333' }
                            }
                        }
                    }
                });

                // Volume chart
                const volumeCtx = document.getElementById('volume-chart').getContext('2d');
                this.charts.volume = new Chart(volumeCtx, {
                    type: 'bar',
                    data: {
                        labels: ['BTC', 'ETH', 'XRP'],
                        datasets: [{
                            label: 'Volume',
                            data: [0, 0, 0],
                            backgroundColor: [
                                'rgba(0, 255, 136, 0.8)',
                                'rgba(255, 165, 0, 0.8)',
                                'rgba(255, 0, 255, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#e0e0e0' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#888' },
                                grid: { color: '#333' }
                            },
                            y: {
                                ticks: { color: '#888' },
                                grid: { color: '#333' }
                            }
                        }
                    }
                });
            }

            setupPanelToggles() {
                const toggles = ['crypto-prices', 'crypto-volumes', 'entry-exit', 'fault-bus'];

                toggles.forEach(panelId => {
                    const checkbox = document.getElementById(`toggle-${panelId}`);
                    if (checkbox) {
                        checkbox.addEventListener('change', (e) => {
                            this.togglePanel(panelId, e.target.checked);
                        });
                    }
                });
            }

            async startDataUpdates() {
                // Update every 3.75 minutes (225 seconds)
                setInterval(() => {
                    this.updateCryptoData();
                    this.updateFaultBusData();
                }, this.updateInterval);

                // Initial update
                await this.updateCryptoData();
                await this.updateFaultBusData();
            }

            async updateCryptoData() {
                try {
                    console.log('üîÑ Updating crypto data...');
                    
                    // Simulate real-time data (replace with actual API calls)
                    const mockData = {
                        btc: {
                            price: 45000 + Math.random() * 5000,
                            volume: 1000000 + Math.random() * 500000,
                            change24h: (Math.random() - 0.5) * 10
                        },
                        eth: {
                            price: 3000 + Math.random() * 500,
                            volume: 800000 + Math.random() * 400000,
                            change24h: (Math.random() - 0.5) * 8
                        },
                        xrp: {
                            price: 0.5 + Math.random() * 0.2,
                            volume: 500000 + Math.random() * 300000,
                            change24h: (Math.random() - 0.5) * 15
                        }
                    };

                    this.cryptoData = mockData;
                    this.updateCryptoDisplay();
                    this.updateCharts();
                    
                } catch (error) {
                    console.error('‚ùå Error updating crypto data:', error);
                }
            }

            async updateFaultBusData() {
                try {
                    console.log('üß† Updating FaultBus data...');
                    
                    // Simulate FaultBus data (replace with actual WebSocket data)
                    const mockFaultBusData = {
                        active_faults: Math.floor(Math.random() * 5),
                        best_strategy: ['aggressive_momentum', 'cautious_reversal', 'balanced_growth'][Math.floor(Math.random() * 3)],
                        strategy_score: Math.random(),
                        corridor_state: ['STABLE', 'VOLATILE', 'TRENDING'][Math.floor(Math.random() * 3)],
                        profit_context: (Math.random() - 0.5) * 100,
                        thermal_state: Math.random(),
                        dlt_acceleration: (Math.random() - 0.5) * 2,
                        multi_bit_confidence: Math.random(),
                        signal_confidence: Math.random()
                    };

                    this.faultBusData = mockFaultBusData;
                    this.updateFaultBusDisplay();
                    
                } catch (error) {
                    console.error('‚ùå Error updating FaultBus data:', error);
                }
            }

            updateCryptoDisplay() {
                // Update price displays
                document.getElementById('btc-price').textContent = `$${this.cryptoData.btc.price.toFixed(2)}`;
                document.getElementById('eth-price').textContent = `$${this.cryptoData.eth.price.toFixed(2)}`;
                document.getElementById('xrp-price').textContent = `$${this.cryptoData.xrp.price.toFixed(4)}`;
                
                // Update volume displays
                document.getElementById('btc-volume').textContent = this.formatVolume(this.cryptoData.btc.volume);
                document.getElementById('eth-volume').textContent = this.formatVolume(this.cryptoData.eth.volume);
                document.getElementById('xrp-volume').textContent = this.formatVolume(this.cryptoData.xrp.volume);
                
                // Update 24h change
                const avgChange = (this.cryptoData.btc.change24h + this.cryptoData.eth.change24h + this.cryptoData.xrp.change24h) / 3;
                const changeElement = document.getElementById('24h-change');
                changeElement.textContent = `${avgChange > 0 ? '+' : ''}${avgChange.toFixed(2)}%`;
                changeElement.className = `data-value ${avgChange > 0 ? 'positive' : avgChange < 0 ? 'negative' : 'neutral'}`;
                
                // Update volume trend
                const volumeTrend = this.calculateVolumeTrend();
                document.getElementById('volume-trend').textContent = volumeTrend;
            }

            updateFaultBusDisplay() {
                // Update FaultBus metrics
                document.getElementById('active-faults').textContent = this.faultBusData.active_faults || '--';
                document.getElementById('best-strategy').textContent = this.faultBusData.best_strategy || '--';
                document.getElementById('strategy-score').textContent = this.faultBusData.strategy_score ? `${(this.faultBusData.strategy_score * 100).toFixed(1)}%` : '--';
                document.getElementById('corridor-state').textContent = this.faultBusData.corridor_state || '--';
                document.getElementById('profit-context').textContent = this.faultBusData.profit_context ? `$${this.faultBusData.profit_context.toFixed(2)}` : '--';
                document.getElementById('thermal-state').textContent = this.faultBusData.thermal_state ? `${(this.faultBusData.thermal_state * 100).toFixed(1)}%` : '--';
                
                // Update signal metrics
                document.getElementById('dlt-acceleration').textContent = this.faultBusData.dlt_acceleration ? `${this.faultBusData.dlt_acceleration.toFixed(3)}` : '--';
                document.getElementById('multi-bit-confidence').textContent = this.faultBusData.multi_bit_confidence ? `${(this.faultBusData.multi_bit_confidence * 100).toFixed(1)}%` : '--';
                document.getElementById('signal-confidence').textContent = this.faultBusData.signal_confidence ? `${(this.faultBusData.signal_confidence * 100).toFixed(1)}%` : '--';
                
                // Update signals based on confidence
                this.updateSignals();
            }

            updateSignals() {
                const confidence = this.faultBusData.signal_confidence || 0;
                const acceleration = this.faultBusData.dlt_acceleration || 0;
                
                // Simple signal logic based on confidence and acceleration
                const getSignal = (baseConfidence, multiplier = 1) => {
                    const adjustedConfidence = baseConfidence * multiplier;
                    if (adjustedConfidence > 0.7) return { signal: 'ENTRY', class: 'signal-entry' };
                    if (adjustedConfidence < 0.3) return { signal: 'EXIT', class: 'signal-exit' };
                    return { signal: 'HOLD', class: 'signal-hold' };
                };
                
                // Update BTC signal
                const btcSignal = getSignal(confidence, 1.1);
                document.getElementById('btc-signal').innerHTML = `<span class="signal-indicator ${btcSignal.class}"></span>${btcSignal.signal}`;
                
                // Update ETH signal
                const ethSignal = getSignal(confidence, 0.9);
                document.getElementById('eth-signal').innerHTML = `<span class="signal-indicator ${ethSignal.class}"></span>${ethSignal.signal}`;
                
                // Update XRP signal
                const xrpSignal = getSignal(confidence, 1.2);
                document.getElementById('xrp-signal').innerHTML = `<span class="signal-indicator ${xrpSignal.class}"></span>${xrpSignal.signal}`;
            }

            updateCharts() {
                const timestamp = new Date().toLocaleTimeString();
                
                // Update price chart
                if (this.charts.price) {
                    this.charts.price.data.labels.push(timestamp);
                    this.charts.price.data.datasets[0].data.push(this.cryptoData.btc.price);
                    this.charts.price.data.datasets[1].data.push(this.cryptoData.eth.price);
                    this.charts.price.data.datasets[2].data.push(this.cryptoData.xrp.price);
                    
                    // Keep only last 20 data points
                    if (this.charts.price.data.labels.length > 20) {
                        this.charts.price.data.labels.shift();
                        this.charts.price.data.datasets.forEach(dataset => dataset.data.shift());
                    }
                    
                    this.charts.price.update('none');
                }
                
                // Update volume chart
                if (this.charts.volume) {
                    this.charts.volume.data.datasets[0].data = [
                        this.cryptoData.btc.volume / 1000000,
                        this.cryptoData.eth.volume / 1000000,
                        this.cryptoData.xrp.volume / 1000000
                    ];
                    this.charts.volume.update('none');
                }
            }

            calculateVolumeTrend() {
                // Simple volume trend calculation
                const totalVolume = this.cryptoData.btc.volume + this.cryptoData.eth.volume + this.cryptoData.xrp.volume;
                if (totalVolume > 2000000) return 'HIGH';
                if (totalVolume > 1500000) return 'MEDIUM';
                return 'LOW';
            }

            formatVolume(volume) {
                if (volume >= 1000000) {
                    return `${(volume / 1000000).toFixed(1)}M`;
                } else if (volume >= 1000) {
                    return `${(volume / 1000).toFixed(1)}K`;
                }
                return volume.toFixed(0);
            }

            connect() {
                try {
                    this.ws = new WebSocket('ws://localhost:8765');
                    
                    this.ws.onopen = () => {
                        console.log('‚úÖ Connected to Schwabot WebSocket server');
                        this.updateConnectionStatus('connected', 'Connected');
                        this.reconnectAttempts = 0;
                    };
                    
                    this.ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleWebSocketMessage(data);
                        } catch (error) {
                            console.error('‚ùå Error parsing WebSocket message:', error);
                        }
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('‚ùå WebSocket error:', error);
                        this.handleConnectionError();
                    };
                    
                    this.ws.onclose = () => {
                        console.log('üîå WebSocket connection closed');
                        this.handleReconnect();
                    };
                    
                } catch (error) {
                    console.error('‚ùå Error connecting to WebSocket:', error);
                    this.handleConnectionError();
                }
            }

            handleWebSocketMessage(data) {
                // Handle different types of messages from the FaultBus
                switch (data.type) {
                    case 'crypto_update':
                        this.cryptoData = data.data;
                        this.updateCryptoDisplay();
                        this.updateCharts();
                        break;
                        
                    case 'fault_bus_update':
                        this.faultBusData = data.data;
                        this.updateFaultBusDisplay();
                        break;
                        
                    case 'system_status':
                        this.updateSystemStatus(data.data);
                        break;
                        
                    default:
                        console.log('üì® Received message:', data);
                }
            }

            updateSystemStatus(status) {
                document.getElementById('uptime').textContent = this.formatUptime(status.uptime || 0);
                document.getElementById('cpu-usage').textContent = `${(status.cpu_usage || 0).toFixed(1)}%`;
                document.getElementById('memory-usage').textContent = `${(status.memory_usage || 0).toFixed(1)}%`;
                document.getElementById('active-connections').textContent = status.active_connections || '--';
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            }

            updateConnectionStatus(status, message) {
                const indicator = document.getElementById('connection-indicator');
                const text = document.getElementById('connection-text');
                
                indicator.className = `status-indicator status-${status}`;
                text.textContent = message;
            }

            togglePanel(panelId, visible) {
                const panel = document.getElementById(`panel-${panelId}`);
                if (panel) {
                    if (visible) {
                        panel.classList.remove('hidden');
                    } else {
                        panel.classList.add('hidden');
                    }
                }
            }

            formatUptime(seconds) {
                if (seconds < 60) return `${seconds.toFixed(0)}s`;
                if (seconds < 3600) return `${(seconds / 60).toFixed(1)}m`;
                return `${(seconds / 3600).toFixed(1)}h`;
            }

            handleConnectionError() {
                this.updateConnectionStatus('disconnected', 'Connection failed');
            }

            handleReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    console.log(`üîÑ Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`);
                    
                    setTimeout(() => {
                        this.connect();
                    }, this.reconnectDelay * this.reconnectAttempts);
                } else {
                    console.error('‚ùå Max reconnection attempts reached');
                    this.updateConnectionStatus('disconnected', 'Connection lost');
                }
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üåü Initializing Enhanced Schwabot Crypto Dashboard...');
            new EnhancedCryptoDashboard();
        });
    </script>
</body>
</html> 