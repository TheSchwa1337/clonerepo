<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KoboldCPP Trading Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .card {
            background-color: var(--card-bg);
            border: 1px solid #444;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: var(--primary-color);
            border-bottom: 1px solid #444;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online { background-color: var(--success-color); }
        .status-offline { background-color: var(--danger-color); }
        .status-warning { background-color: var(--warning-color); }
        
        .metric-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .trading-panel {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .signal-item {
            background-color: var(--card-bg);
            border-left: 4px solid var(--secondary-color);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .signal-buy { border-left-color: var(--success-color); }
        .signal-sell { border-left-color: var(--danger-color); }
        .signal-hold { border-left-color: var(--warning-color); }
        
        .btn-trading {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-buy { background-color: var(--success-color); border-color: var(--success-color); }
        .btn-sell { background-color: var(--danger-color); border-color: var(--danger-color); }
        .btn-hold { background-color: var(--warning-color); border-color: var(--warning-color); }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }
        
        .real-time-update {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .cryptocurrency-selector {
            background-color: var(--card-bg);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .crypto-option {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background-color: var(--primary-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .crypto-option:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }
        
        .crypto-option.active {
            background-color: var(--secondary-color);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot"></i> KoboldCPP Trading System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <span class="status-indicator status-online" id="system-status"></span>
                    System Online
                </span>
                <a class="nav-link" href="/logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- System Status Panel -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-server"></i> System Status
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="kobold-status">Loading...</div>
                            <div class="metric-label">KoboldCPP Status</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="trading-decisions">0</div>
                            <div class="metric-label">Trading Decisions</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="active-signals">0</div>
                            <div class="metric-label">Active Signals</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="tensor-score">0.0</div>
                            <div class="metric-label">Tensor Score</div>
                        </div>
                    </div>
                </div>

                <!-- Cryptocurrency Selector -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-coins"></i> Cryptocurrencies
                    </div>
                    <div class="card-body">
                        <div class="cryptocurrency-selector">
                            <div class="crypto-option active" data-symbol="BTC/USDC">BTC</div>
                            <div class="crypto-option" data-symbol="ETH/USDC">ETH</div>
                            <div class="crypto-option" data-symbol="XRP/USDC">XRP</div>
                            <div class="crypto-option" data-symbol="SOL/USDC">SOL</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Trading Panel -->
            <div class="col-md-6">
                <div class="trading-panel">
                    <h3><i class="fas fa-chart-line"></i> Live Trading Dashboard</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="symbol-input">Symbol</label>
                                <input type="text" class="form-control" id="symbol-input" value="BTC/USDC" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="price-input">Current Price</label>
                                <input type="number" class="form-control" id="price-input" value="50000" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="volume-input">Volume</label>
                                <input type="number" class="form-control" id="volume-input" value="1000" step="0.01">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="volatility-input">Volatility</label>
                                <input type="number" class="form-control" id="volatility-input" value="0.15" step="0.01">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="bit-phase-input">Bit Phase</label>
                                <select class="form-control" id="bit-phase-input">
                                    <option value="4">4-bit</option>
                                    <option value="8" selected>8-bit</option>
                                    <option value="16">16-bit</option>
                                    <option value="32">32-bit</option>
                                    <option value="42">42-bit</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12 text-center">
                            <button class="btn btn-primary btn-trading" onclick="analyzeMarket()">
                                <i class="fas fa-brain"></i> Analyze with KoboldCPP
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-bar"></i> Analysis Results
                    </div>
                    <div class="card-body">
                        <div id="analysis-results">
                            <p class="text-muted">Click "Analyze with KoboldCPP" to get started...</p>
                        </div>
                    </div>
                </div>

                <!-- Trading Actions -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-trade"></i> Trading Actions
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <button class="btn btn-success btn-trading w-100" onclick="executeTrade('BUY')">
                                    <i class="fas fa-arrow-up"></i> BUY
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-warning btn-trading w-100" onclick="executeTrade('HOLD')">
                                    <i class="fas fa-pause"></i> HOLD
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-danger btn-trading w-100" onclick="executeTrade('SELL')">
                                    <i class="fas fa-arrow-down"></i> SELL
                                </button>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="trade-amount">Trade Amount</label>
                                    <input type="number" class="form-control" id="trade-amount" value="0.01" step="0.001">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="confidence-display">Confidence</label>
                                    <div class="progress">
                                        <div class="progress-bar" id="confidence-bar" role="progressbar" style="width: 0%">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Signals -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-bell"></i> Real-time Signals
                    </div>
                    <div class="card-body">
                        <div id="signals-container">
                            <p class="text-muted">Waiting for signals...</p>
                        </div>
                    </div>
                </div>

                <!-- Mathematical Components -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-calculator"></i> Mathematical Components
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="tensor-memory-status">Active</div>
                            <div class="metric-label">Tensor Memory</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="strategy-mapper-status">Active</div>
                            <div class="metric-label">Strategy Mapper</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="visual-engine-status">Active</div>
                            <div class="metric-label">Visual Engine</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="soulprint-status">Active</div>
                            <div class="metric-label">Soulprint Registry</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Socket.IO connection
        const socket = io();
        let currentSymbol = 'BTC/USDC';
        let currentAnalysis = null;

        // Socket event handlers
        socket.on('connect', function(data) {
            console.log('Connected to server');
            updateSystemStatus('online');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
            updateSystemStatus('offline');
        });

        socket.on('system_status', function(data) {
            updateSystemMetrics(data);
        });

        socket.on('market_analysis', function(data) {
            displayAnalysisResults(data);
            addSignal(data);
        });

        socket.on('trade_executed', function(data) {
            addSignal(data);
        });

        // Update system status indicator
        function updateSystemStatus(status) {
            const indicator = document.getElementById('system-status');
            indicator.className = `status-indicator status-${status}`;
        }

        // Update system metrics
        function updateSystemMetrics(data) {
            if (data.koboldcpp) {
                document.getElementById('kobold-status').textContent = 
                    data.koboldcpp.kobold_running ? 'Online' : 'Offline';
            }
            if (data.trading_signals) {
                document.getElementById('active-signals').textContent = 
                    data.trading_signals.total_signals;
            }
        }

        // Cryptocurrency selector
        document.querySelectorAll('.crypto-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.crypto-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                currentSymbol = this.dataset.symbol;
                document.getElementById('symbol-input').value = currentSymbol;
            });
        });

        // Analyze market data
        async function analyzeMarket() {
            const symbol = document.getElementById('symbol-input').value;
            const price = parseFloat(document.getElementById('price-input').value);
            const volume = parseFloat(document.getElementById('volume-input').value);
            const volatility = parseFloat(document.getElementById('volatility-input').value);
            const bitPhase = parseInt(document.getElementById('bit-phase-input').value);

            const marketData = {
                symbol: symbol,
                price: price,
                volume: volume,
                volatility: volatility,
                bit_phase: bitPhase
            };

            try {
                const response = await fetch('/api/market/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(marketData)
                });

                const result = await response.json();
                if (result.success) {
                    displayAnalysisResults(result.analysis);
                    currentAnalysis = result.analysis;
                } else {
                    alert('Analysis failed: ' + result.error);
                }
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Analysis failed: ' + error.message);
            }
        }

        // Display analysis results
        function displayAnalysisResults(analysis) {
            const container = document.getElementById('analysis-results');
            
            const confidence = (analysis.confidence * 100).toFixed(1);
            document.getElementById('confidence-bar').style.width = confidence + '%';
            document.getElementById('confidence-bar').textContent = confidence + '%';

            container.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5>Action: <span class="badge bg-${getActionColor(analysis.action)}">${analysis.action}</span></h5>
                        <p><strong>Confidence:</strong> ${(analysis.confidence * 100).toFixed(1)}%</p>
                        <p><strong>Bit Phase Result:</strong> ${analysis.bit_phase_result}</p>
                        <p><strong>Tensor Score:</strong> ${analysis.tensor_score.toFixed(3)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Mathematical Consensus:</h6>
                        <p><strong>Combined Confidence:</strong> ${(analysis.mathematical_consensus.combined_confidence * 100).toFixed(1)}%</p>
                        <p><strong>Bit Phase Alignment:</strong> ${analysis.mathematical_consensus.bit_phase_alignment ? '✓' : '✗'}</p>
                        <p><strong>Tensor Alignment:</strong> ${analysis.mathematical_consensus.tensor_alignment ? '✓' : '✗'}</p>
                    </div>
                </div>
            `;
        }

        // Get action color
        function getActionColor(action) {
            switch (action) {
                case 'BUY': return 'success';
                case 'SELL': return 'danger';
                case 'HOLD': return 'warning';
                default: return 'secondary';
            }
        }

        // Execute trade
        async function executeTrade(action) {
            if (!currentAnalysis) {
                alert('Please analyze market data first');
                return;
            }

            const symbol = document.getElementById('symbol-input').value;
            const amount = parseFloat(document.getElementById('trade-amount').value);

            const tradeData = {
                symbol: symbol,
                action: action,
                amount: amount
            };

            try {
                const response = await fetch('/api/trading/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(tradeData)
                });

                const result = await response.json();
                if (result.success) {
                    alert(`Trade executed: ${action} ${amount} ${symbol}`);
                } else {
                    alert('Trade execution failed: ' + result.error);
                }
            } catch (error) {
                console.error('Trade execution error:', error);
                alert('Trade execution failed: ' + error.message);
            }
        }

        // Add signal to signals container
        function addSignal(signal) {
            const container = document.getElementById('signals-container');
            const signalElement = document.createElement('div');
            signalElement.className = `signal-item signal-${signal.action.toLowerCase()} real-time-update`;
            
            const time = new Date(signal.timestamp * 1000).toLocaleTimeString();
            signalElement.innerHTML = `
                <div class="d-flex justify-content-between">
                    <strong>${signal.symbol}</strong>
                    <small>${time}</small>
                </div>
                <div class="d-flex justify-content-between">
                    <span class="badge bg-${getActionColor(signal.action)}">${signal.action}</span>
                    <span>${(signal.confidence * 100).toFixed(1)}%</span>
                </div>
            `;
            
            container.insertBefore(signalElement, container.firstChild);
            
            // Remove old signals if too many
            const signals = container.querySelectorAll('.signal-item');
            if (signals.length > 10) {
                signals[signals.length - 1].remove();
            }
            
            // Remove animation after 2 seconds
            setTimeout(() => {
                signalElement.classList.remove('real-time-update');
            }, 2000);
        }

        // Load initial system status
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();
                updateSystemMetrics(data);
            } catch (error) {
                console.error('Failed to load system status:', error);
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            
            // Update system status every 30 seconds
            setInterval(loadSystemStatus, 30000);
        });
    </script>
</body>
</html> 